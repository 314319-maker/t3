<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£Ÿå…‰å®ˆè­·è€…ï½œ2025 å°ˆé¡Œç«¶è³½ä½œå“</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }

        /* èƒŒæ™¯è³ªæ„Ÿç´‹ç† */
        .bg-pattern {
            background-color: #f8fafc;
            background-image: radial-gradient(#e2e8f0 1px, transparent 1px);
            background-size: 24px 24px;
        }

        /* å‹•ç•«ç‰¹æ•ˆ */
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-up { animation: fade-in-up 0.8s ease-out forwards; }
       
        @keyframes scan-line {
            0% { top: 0%; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }
        .scan-line-animation {
            position: absolute; left: 0; width: 100%; height: 2px;
            background-color: #38bdf8; box-shadow: 0 0 4px #38bdf8;
            animation: scan-line 2s linear infinite;
        }
       
        .tab-content.hidden { display: none; }
       
        /* å°èˆªåˆ—æ¨£å¼ */
        .nav-link {
            cursor: pointer;
            padding: 0.5rem 1rem;
            color: #64748b;
            font-weight: 500;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .nav-link:hover { color: #0ea5e9; }
        .nav-link.active {
            color: #0284c7;
            border-bottom: 2px solid #0284c7;
        }

        .story-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .calendar-day { min-height: 80px; transition: all 0.2s; }
        .calendar-day:hover { background-color: #f0f9ff; }
        .calendar-day.active-day { background-color: #e0f2fe; border: 2px solid #0ea5e9; }
        .badge-locked { filter: grayscale(100%); opacity: 0.5; }
        
        /* å‹³ç« è§£é–å‹•ç•« */
        @keyframes pop-in {
            0% { transform: scale(0.5); opacity: 0; }
            80% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .badge-unlocked-anim { animation: pop-in 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
    </style>
</head>
<body class="bg-pattern min-h-screen flex flex-col text-slate-800">

    <!-- å°èˆªåˆ— (é è¨­éš±è—ï¼Œé€²å…¥ç³»çµ±å¾Œé¡¯ç¤º) -->
    <nav id="main-nav" class="bg-white/90 backdrop-blur-md shadow-sm sticky top-0 z-50 hidden transition-all duration-500">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <!-- é»æ“Š Logo å›åˆ°é¦–é  -->
                <div class="flex items-center gap-2 cursor-pointer" onclick="switchTab('landing')">
                    <img src="https://cdn-icons-png.flaticon.com/512/2921/2921822.png" alt="é£Ÿå…‰å®ˆè­·è€… Logo" class="w-8 h-8 rounded-lg object-cover">
                    <span class="text-xl font-bold text-slate-800 hidden sm:block">é£Ÿå…‰å®ˆè­·è€…</span>
                </div>

                <div class="hidden md:flex space-x-1 overflow-x-auto no-scrollbar w-full ml-4">
                    <!-- åŠŸèƒ½é¸å–® -->
                    <a onclick="switchTab('inventory')" id="nav-inventory" class="nav-link">é£Ÿæç®¡ç†</a>
                    <a onclick="switchTab('calendar')" id="nav-calendar" class="nav-link">æ•ˆæœŸæ—¥æ›†</a>
                    <a onclick="switchTab('recipes')" id="nav-recipes" class="nav-link">é£Ÿè­œåŒ¹é…</a>
                    <a onclick="switchTab('shopping')" id="nav-shopping" class="nav-link">è³¼ç‰©æ¸…å–®</a>
                    <a onclick="switchTab('community')" id="nav-community" class="nav-link">æƒœé£Ÿå¸‚é›†</a>
                    <a onclick="switchTab('analytics')" id="nav-analytics" class="nav-link">æ•¸æ“šåˆ†æ</a>
                    <a onclick="switchTab('storybook')" id="nav-storybook" class="nav-link">ç¹ªæœ¬æ•…äº‹</a>
                    <a onclick="switchTab('interactive')" id="nav-interactive" class="nav-link">äº’å‹•æˆå°±</a>
                </div>
               
                <div class="relative ml-4" id="user-menu-container">
                     <button id="login-btn" class="flex items-center gap-2 px-3 py-1.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 shadow-sm transition">
                        <span>ç™»å…¥</span>
                    </button>
                    <div id="user-dropdown" class="absolute right-0 top-full mt-3 w-56 bg-white rounded-xl shadow-xl border border-gray-100 hidden flex-col overflow-hidden z-[60] transform origin-top-right transition-all animate-fade-up">
                        <div class="px-4 py-3 border-b border-gray-50 bg-gray-50/80">
                            <p class="text-xs text-gray-500 mb-1">ç›®å‰ä½¿ç”¨è€…</p>
                            <p id="user-email-display" class="text-sm font-bold text-gray-800 truncate">user@example.com</p>
                        </div>
                        <button id="logout-btn" class="w-full text-left px-4 py-3 text-rose-500 hover:bg-rose-50 hover:text-rose-600 transition font-bold text-sm flex items-center gap-2 group">
                            <svg class="w-4 h-4 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                            ç™»å‡ºç³»çµ±
                        </button>
                    </div>
                </div>
            </div>
        </div>
       
        <!-- æ‰‹æ©Ÿç‰ˆé¸å–® -->
        <div class="md:hidden flex overflow-x-auto px-4 pb-2 space-x-4 text-sm whitespace-nowrap border-t bg-white no-scrollbar">
            <a onclick="switchTab('inventory')" class="py-2 text-gray-600">åº«å­˜</a>
            <a onclick="switchTab('calendar')" class="py-2 text-gray-600">æ—¥æ›†</a>
            <a onclick="switchTab('recipes')" class="py-2 text-gray-600">é£Ÿè­œ</a>
            <a onclick="switchTab('shopping')" class="py-2 text-gray-600">è³¼ç‰©</a>
            <a onclick="switchTab('analytics')" class="py-2 text-gray-600">æ•¸æ“š</a>
            <a onclick="switchTab('interactive')" class="py-2 text-gray-600">æˆå°±</a>
        </div>
    </nav>

    <div class="flex-grow w-full">
       
        <!-- ç¨ç«‹é¦–é  (Landing Page) - å…¨è¢å¹•é¡¯ç¤º -->
        <div id="landing-tab-content" class="tab-content w-full h-screen fixed inset-0 z-40 bg-white overflow-y-auto">
            <div class="bg-gradient-to-b from-sky-50 to-white min-h-full flex items-center justify-center">
                <div class="max-w-7xl mx-auto px-6 py-12 grid md:grid-cols-2 gap-12 items-center">
                    <div class="space-y-8 animate-fade-up">
                        <div class="inline-block bg-blue-100 text-blue-800 text-sm font-bold px-4 py-1.5 rounded-full shadow-sm border border-blue-200">
                            ğŸ† 2025 å…¨åœ‹é«˜ä¸­è·å•†æ¥­é¡å‰µæ„å°ˆé¡Œç«¶è³½
                        </div>
                        <h1 class="text-5xl md:text-7xl font-bold text-slate-800 leading-tight tracking-tight">
                            é£Ÿå…‰å®ˆè­·è€…<br><span class="text-sky-500">Food Guardian</span>
                        </h1>
                        <p class="text-xl text-slate-500 font-medium">Research Title: AI-Powered Smart Food Guardian</p>
                        <p class="text-slate-600 text-lg leading-relaxed text-justify max-w-lg">
                            åˆ¥è®“å†°ç®±æˆç‚ºé£Ÿç‰©çš„å¢³å ´ã€‚æˆ‘å€‘æ•´åˆ <span class="font-bold text-sky-600">AI å½±åƒè¾¨è­˜</span> èˆ‡ <span class="font-bold text-amber-500">é›²ç«¯å¤§æ•¸æ“š</span>ï¼Œæ‰“é€ å…¨æ–¹ä½çš„æ™ºæ…§é£Ÿæç®¡ç†ç³»çµ±ï¼Œå¾å…¥åº«åˆ°æ–™ç†ï¼Œå…¨ç¨‹å®ˆè­·æ‚¨çš„æ¯ä¸€ä»½æ–°é®®ã€‚
                        </p>
                        
                        <div class="flex flex-col sm:flex-row gap-4 pt-4">
                            <!-- é€²å…¥ç³»çµ±æŒ‰éˆ• - é»æ“Šå¾Œé¡¯ç¤ºå°èˆªåˆ—ä¸¦è·³è½‰ -->
                            <button onclick="switchTab('inventory')" class="px-8 py-4 bg-sky-500 text-white rounded-full font-bold text-lg shadow-xl hover:bg-sky-600 hover:shadow-2xl transform transition hover:-translate-y-1 flex items-center justify-center gap-2">
                                <span>ğŸš€ é–‹å§‹ä½¿ç”¨</span>
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg>
                            </button>
                            <!-- å·²æ›´æ”¹ï¼šè·³è½‰è‡³æ•¸æ“šåˆ†æ -->
                            <button onclick="switchTab('analytics')" class="px-8 py-4 bg-white border-2 border-sky-200 text-sky-600 rounded-full font-bold text-lg hover:border-sky-400 hover:text-sky-700 transition shadow-sm flex items-center justify-center gap-2">
                                <span>ğŸ“Š æ•¸æ“šåˆ†æ</span>
                            </button>
                        </div>
                        <p class="text-sm text-slate-400 mt-8">
                            * æœ¬ç³»çµ±ç›®å‰æ”¯æ´è­˜åˆ¥è¶…é 1000 ç¨®å¸¸è¦‹é£Ÿæ
                        </p>
                    </div>
                
                    <!-- é¦–é å³å´è¦–è¦ºåœ– -->
                    <div class="relative animate-fade-up flex justify-center items-center hidden md:flex" style="animation-delay: 0.2s;">
                        <div class="absolute w-[500px] h-[500px] bg-sky-100 rounded-full blur-3xl -z-10 opacity-60"></div>
                        <div class="relative w-96 h-96 rounded-full overflow-hidden shadow-2xl border-8 border-white group">
                            <img src="https://images.unsplash.com/photo-1490645935967-10de6ba17061?q=80&w=800&auto=format&fit=crop"
                                class="w-full h-full object-cover transform group-hover:scale-110 transition duration-700"
                                alt="é£Ÿå…‰å®ˆè­·è€… ä¸»è¦–è¦º">
                            <div class="absolute inset-0 bg-black/20 flex items-center justify-center opacity-0 group-hover:opacity-100 transition duration-300">
                                <span class="text-white font-bold text-2xl tracking-widest">FOOD GUARDIAN</span>
                            </div>
                        </div>
                        <!-- æ¼‚æµ®çš„å°å¡ç‰‡è£é£¾ -->
                        <div class="absolute -bottom-6 -left-6 bg-white p-4 rounded-xl shadow-lg animate-bounce" style="animation-duration: 3s;">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center text-xl">ğŸ¥¦</div>
                                <div>
                                    <p class="text-xs text-gray-500">åº«å­˜ç‹€æ…‹</p>
                                    <p class="font-bold text-green-600">æ–°é®®</p>
                                </div>
                            </div>
                        </div>
                        <div class="absolute top-10 -right-6 bg-white p-4 rounded-xl shadow-lg animate-bounce" style="animation-duration: 4s;">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center text-xl">ğŸ¥›</div>
                                <div>
                                    <p class="text-xs text-gray-500">å³æœŸæé†’</p>
                                    <p class="font-bold text-red-600">å‰© 2 å¤©</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç³»çµ±åŠŸèƒ½å…§å®¹å€åŸŸ (åŒ…å« Navbar ä¸‹çš„æ‰€æœ‰é é¢) -->
        <div class="max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8">

            <!-- 1. é£Ÿæç®¡ç† Tab -->
            <div id="inventory-tab-content" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg border border-slate-100 h-min sticky top-20">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-2">
                                <div class="bg-gray-100 p-1 rounded">ğŸ“·</div>
                                <h2 class="text-xl font-bold text-gray-800">æ–°å¢é£Ÿæ</h2>
                            </div>
                            <button id="notify-btn" class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded hover:bg-slate-200 transition" title="é–‹å•Ÿç€è¦½å™¨é€šçŸ¥">
                                ğŸ”” é–‹å•Ÿæé†’
                            </button>
                        </div>
                       
                        <div class="relative w-full aspect-video bg-[#0f172a] rounded-lg shadow-inner overflow-hidden flex items-center justify-center mb-4">
                            <video id="camera-stream" class="w-full h-full object-cover" autoplay playsinline style="display:none;"></video>
                            <div id="camera-overlay" class="absolute inset-0 flex flex-col items-center justify-center text-slate-500">
                                <svg class="w-12 h-12 mb-2 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                                <p class="text-sm font-medium">ç›¸æ©Ÿå·²é—œé–‰</p>
                            </div>
                            <div id="ai-scan-effect" class="absolute inset-0 hidden pointer-events-none z-20">
                                <div class="scan-line-animation"></div>
                                <div class="absolute top-2 left-2 bg-sky-500/80 text-white text-xs px-2 py-1 rounded animate-pulse">AI å¤šé‡è­˜åˆ¥ä¸­...</div>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-3 mb-3">
                            <button type="button" id="start-camera-btn" class="bg-[#0ea5e9] text-white py-2.5 rounded-lg hover:bg-[#0284c7] font-bold shadow-sm transition active:scale-95">
                                é–‹å•Ÿé¡é ­
                            </button>
                            <button type="button" id="stop-camera-btn" class="bg-[#f43f5e] text-white py-2.5 rounded-lg hover:bg-[#e11d48] font-bold shadow-sm transition active:scale-95" disabled>
                                é—œé–‰
                            </button>
                        </div>
                        <button type="button" id="rescan-btn" class="w-full mb-4 bg-[#f59e0b] text-white py-2.5 rounded-lg hover:bg-[#d97706] font-bold shadow-sm transition flex items-center justify-center gap-2 active:scale-95" disabled>
                            é‡æ–°æƒæ
                        </button>

                        <div class="bg-slate-50 p-3 rounded-lg border border-slate-200 mb-4">
                            <p class="text-slate-500 text-xs mb-2">æ‰‹å‹•è¼¸å…¥ä»£ç¢¼ (å¯è¼¸å…¥å¤šå€‹ï¼Œä»¥ç©ºæ ¼æˆ–é€—è™Ÿåˆ†éš”)ï¼š</p>
                            <div class="flex gap-2">
                                <input type="text" id="scan-input" placeholder="å¦‚: 1 88 1024" class="flex-1 border border-slate-300 rounded px-3 py-1.5 text-sm focus:ring-2 focus:ring-sky-200 outline-none">
                                <button type="button" id="manual-scan-btn" class="bg-white border border-slate-300 text-slate-600 px-3 py-1.5 rounded text-sm font-bold hover:bg-slate-50 transition active:scale-95">æŸ¥è©¢</button>
                            </div>
                        </div>

                        <form id="add-ingredient-form" class="space-y-3 pt-2 border-t border-slate-100">
                            <div>
                                <label class="text-sm font-bold text-gray-700">é£Ÿæåç¨±</label>
                                <input type="text" id="name" required placeholder="ç­‰å¾…è­˜åˆ¥..." class="w-full mt-1 border border-slate-300 rounded-lg p-2.5 bg-white focus:border-sky-500 focus:ring-sky-500 outline-none">
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="text-sm font-bold text-gray-700">ç¨®é¡</label>
                                    <select id="type" class="w-full mt-1 border border-slate-300 rounded-lg p-2.5 bg-white outline-none">
                                        <option value="è”¬èœ">è”¬èœ</option>
                                        <option value="è‚‰é¡">è‚‰é¡</option>
                                        <option value="æµ·é®®">æµ·é®®</option>
                                        <option value="æ°´æœ">æ°´æœ</option>
                                        <option value="å¥¶è£½å“">å¥¶è£½å“</option>
                                        <option value="ä¸»é£Ÿ">ä¸»é£Ÿ</option>
                                        <option value="é£²æ–™">é£²æ–™</option>
                                        <option value="èª¿å‘³æ–™">èª¿å‘³æ–™</option>
                                        <option value="å…¶ä»–">å…¶ä»–</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="text-sm font-bold text-[#d97706]">ğŸ“… æœ‰æ•ˆæœŸé™</label>
                                    <input type="date" id="expiryDate" required class="w-full mt-1 border border-[#fcd34d] rounded-lg p-2.5 bg-[#fffbeb] text-gray-700 outline-none">
                                </div>
                            </div>
                            <button type="submit" class="w-full mt-2 bg-[#0ea5e9] text-white py-3 rounded-lg font-bold shadow-md hover:bg-[#0284c7] transform transition active:scale-95 flex items-center justify-center gap-2">
                                ç¢ºèªå…¥åº«
                            </button>
                        </form>
                    </div>

                    <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg border-t-4 border-[#0ea5e9]">
                        <div class="flex justify-between items-center mb-4 border-b pb-3">
                            <h2 class="text-xl font-bold text-gray-800">ğŸ“¦ å†°ç®±åº«å­˜æ¸…å–®</h2>
                            <button id="delete-expired-btn" class="text-sm bg-rose-50 text-rose-600 px-3 py-1.5 rounded-lg hover:bg-rose-100 font-bold transition border border-rose-100 flex items-center gap-1">
                                æ¸…é™¤æ‰€æœ‰éæœŸ
                            </button>
                        </div>
                        <div id="ingredient-list" class="space-y-3 max-h-[600px] overflow-y-auto pr-2">
                            <p class="text-center text-gray-400 py-10">è®€å–ä¸­...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 2. æ—¥æ›† Tab -->
            <div id="calendar-tab-content" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg border border-slate-100">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-bold text-slate-800 flex items-center gap-2">ğŸ“… æ•ˆæœŸæ—¥æ›†</h2>
                            <div class="flex items-center gap-4 bg-slate-50 px-4 py-1 rounded-full border border-slate-200">
                                <button onclick="changeMonth(-1)" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-white hover:shadow text-slate-500 font-bold">â€¹</button>
                                <span id="calendar-month-year" class="font-bold text-slate-700 w-28 text-center">Loading...</span>
                                <button onclick="changeMonth(1)" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-white hover:shadow text-slate-500 font-bold">â€º</button>
                            </div>
                        </div>
                        <div class="grid grid-cols-7 gap-1 text-center mb-2">
                            <div class="text-xs font-bold text-rose-500">æ—¥</div><div class="text-xs font-bold text-slate-500">ä¸€</div><div class="text-xs font-bold text-slate-500">äºŒ</div><div class="text-xs font-bold text-slate-500">ä¸‰</div><div class="text-xs font-bold text-slate-500">å››</div><div class="text-xs font-bold text-slate-500">äº”</div><div class="text-xs font-bold text-slate-500">å…­</div>
                        </div>
                        <div id="calendar-grid" class="grid grid-cols-7 gap-1"></div>
                        <div class="flex gap-4 mt-6 text-xs text-slate-500 justify-end">
                            <div class="flex items-center gap-1"><div class="w-2 h-2 rounded-full bg-rose-500"></div> éæœŸ/ç•¶æ—¥</div>
                            <div class="flex items-center gap-1"><div class="w-2 h-2 rounded-full bg-amber-400"></div> å³æœŸ (3å¤©å…§)</div>
                            <div class="flex items-center gap-1"><div class="w-2 h-2 rounded-full bg-green-400"></div> æ–°é®®</div>
                        </div>
                    </div>
                    <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg border border-slate-100 h-min">
                        <h3 class="font-bold text-slate-700 mb-4 flex items-center gap-2 border-b pb-2">
                            <span id="selected-date-display" class="text-lg text-sky-600">è«‹é»æ“Šæ—¥æœŸ</span>
                            <span class="text-xs text-slate-400 ml-auto bg-slate-100 px-2 py-1 rounded">ç•¶æ—¥åˆ°æœŸé …ç›®</span>
                        </h3>
                        <div id="calendar-detail-list" class="space-y-3 min-h-[200px]">
                            <p class="text-center text-gray-400 py-8 text-sm">é»æ“Šæ—¥æ›†ä¸Šçš„æ—¥æœŸ<br>æŸ¥çœ‹ç•¶å¤©åˆ°æœŸçš„é£Ÿæ</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 3. é£Ÿè­œ Tab (æ›´æ–°ç‰ˆæœ¬) -->
            <div id="recipes-tab-content" class="tab-content hidden">
                <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-[#f43f5e]">
                    <div class="flex items-center gap-2 mb-2">
                        <svg class="w-6 h-6 text-[#f43f5e]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                        <h2 class="text-xl font-bold text-gray-800">æ™ºèƒ½é£Ÿè­œåŒ¹é…</h2>
                    </div>
                    <div class="bg-[#fff1f2] border border-[#fecdd3] p-4 rounded-lg mb-6 text-[#be123c] text-sm font-medium">
                        ç³»çµ±æœƒæ ¹æ“šæ‚¨ç›®å‰çš„ã€Œåº«å­˜é£Ÿæã€ä¾†æ¨è–¦æ–™ç†ã€‚ç¼ºå°‘çš„é£Ÿææœƒè‡ªå‹•æ¨™ç¤ºã€‚
                    </div>
                    <button id="match-recipe-btn" class="mb-8 bg-[#f43f5e] text-white px-8 py-2.5 rounded-lg font-bold hover:bg-[#e11d48] shadow-md transition flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        å°‹æ‰¾å¯è£½ä½œæ–™ç†
                    </button>
                    <!-- ä¿®æ”¹ç‚ºå¡ç‰‡ç¶²æ ¼ -->
                    <div id="recipe-results" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="col-span-full text-center py-12 bg-gray-50 rounded-xl border border-dashed border-gray-300">
                            <p class="text-gray-500 font-medium">é»æ“Šä¸Šæ–¹æŒ‰éˆ•ï¼ŒAI å°‡ç‚ºæ‚¨åˆ†ææœ€ä½³é£Ÿè­œï¼</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 4. è³¼ç‰©æ¸…å–® Tab -->
            <div id="shopping-tab-content" class="tab-content hidden">
                <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-indigo-500">
                    <div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold text-gray-800">ğŸ›’ æ™ºæ…§è³¼ç‰©æ¸…å–®</h2><button onclick="autoGenerateShoppingList()" class="text-sm bg-indigo-50 text-indigo-600 px-3 py-1.5 rounded-lg hover:bg-indigo-100 font-bold transition">âœ¨ ä¸€éµåŒ¯å…¥ç¼ºè²¨é£Ÿæ</button></div>
                    <div class="flex gap-2 mb-6"><input type="text" id="shopping-input" placeholder="è¼¸å…¥æƒ³è²·çš„æ±è¥¿..." class="flex-1 border border-slate-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-300 outline-none"><button onclick="addShoppingItem()" class="bg-indigo-500 text-white px-6 py-2 rounded-lg font-bold hover:bg-indigo-600 transition">æ–°å¢</button></div>
                    <ul id="shopping-list-container" class="space-y-2"></ul>
                </div>
            </div>

            <!-- 5. æƒœé£Ÿå¸‚é›† Tab -->
            <div id="community-tab-content" class="tab-content hidden">
                <div class="text-center mb-8 animate-fade-up"><h2 class="text-2xl font-bold text-slate-800">ğŸ¤ æƒœé£Ÿäº’åŠ©å¸‚é›†</h2><p class="text-slate-500">å°‡å¤šé¤˜çš„é£Ÿæåˆ†äº«çµ¦é™„è¿‘çš„é„°å±…ï¼Œä¸€èµ·æ¸›å°‘æµªè²»ï¼</p></div>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="bg-white rounded-xl shadow-md overflow-hidden border border-slate-100 hover:shadow-xl transition group">
                        <div class="h-40 bg-orange-100 relative overflow-hidden"><img src="https://images.unsplash.com/photo-1598170845058-32b9d6a5da37?q=80&w=400" class="w-full h-full object-cover group-hover:scale-110 transition duration-500"><div class="absolute bottom-2 left-2 bg-white/90 px-2 py-1 rounded text-xs font-bold text-orange-600">è·é›¢ 500m</div></div>
                        <div class="p-5"><div class="flex justify-between items-start mb-2"><h3 class="font-bold text-lg">æ–°é®®ç´…è˜¿è””</h3><span class="bg-green-100 text-green-700 text-xs px-2 py-0.5 rounded-full">å…è²»è´ˆé€</span></div><p class="text-sm text-slate-500 mb-4">è²·å¤ªå¤šäº†åƒä¸å®Œï¼Œé‚„æœ‰å¤§ç´„ 3 æ ¹ï¼Œå¸Œæœ›èƒ½é€çµ¦éœ€è¦çš„äººï¼</p><div class="flex items-center justify-between border-t pt-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-xs font-bold">é™³</div><span class="text-sm text-slate-600">é™³å°ç¾</span></div><button onclick="Swal.fire('å·²é€å‡ºè«‹æ±‚', 'å°æ–¹å°‡æœƒæ”¶åˆ°æ‚¨çš„è¨Šæ¯', 'success')" class="text-sm bg-orange-500 text-white px-3 py-1.5 rounded hover:bg-orange-600 transition">æˆ‘æƒ³è¦</button></div></div>
                    </div>
                    <div class="bg-white rounded-xl shadow-md overflow-hidden border border-slate-100 hover:shadow-xl transition group">
                        <div class="h-40 bg-green-100 relative overflow-hidden"><img src="https://images.unsplash.com/photo-1550989460-0adf9ea622e2?q=80&w=400" class="w-full h-full object-cover group-hover:scale-110 transition duration-500"><div class="absolute bottom-2 left-2 bg-white/90 px-2 py-1 rounded text-xs font-bold text-green-600">è·é›¢ 1.2km</div></div>
                        <div class="p-5"><div class="flex justify-between items-start mb-2"><h3 class="font-bold text-lg">æœ‰æ©Ÿå°ç™½èœ</h3><span class="bg-blue-100 text-blue-700 text-xs px-2 py-0.5 rounded-full">ä»¥ç‰©æ˜“ç‰©</span></div><p class="text-sm text-slate-500 mb-4">é€™é€±é…é€çš„è”¬èœç®±å¤ªå¤šäº†ï¼Œæƒ³äº¤æ›æ°´æœæˆ–æ˜¯é£²æ–™ã€‚</p><div class="flex items-center justify-between border-t pt-3"><div class="flex items-center gap-2"><div class="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-xs font-bold">ç‹</div><span class="text-sm text-slate-600">ç‹å¤§æ˜</span></div><button onclick="Swal.fire('å·²é€å‡ºè«‹æ±‚', 'å°æ–¹å°‡æœƒæ”¶åˆ°æ‚¨çš„è¨Šæ¯', 'success')" class="text-sm bg-blue-500 text-white px-3 py-1.5 rounded hover:bg-blue-600 transition">äº¤æ›</button></div></div>
                    </div>
                     <div class="bg-slate-50 rounded-xl border-2 border-dashed border-slate-300 flex flex-col items-center justify-center p-6 text-center hover:bg-slate-100 transition cursor-pointer" onclick="Swal.fire('åŠŸèƒ½é–‹ç™¼ä¸­', 'æ­¤åŠŸèƒ½å°‡å…è¨±æ‚¨ä¸Šå‚³å®¶ä¸­å¤šé¤˜é£Ÿæ', 'info')">
                        <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center shadow-sm mb-3 text-3xl">â•</div><h3 class="font-bold text-slate-700">åˆŠç™»æ‚¨çš„é£Ÿæ</h3><p class="text-sm text-slate-500">åˆ†äº«å¤šé¤˜çš„é£Ÿç‰©ï¼Œè®“æ„›å»¶çºŒ</p>
                    </div>
                </div>
            </div>

            <!-- 6. æ•¸æ“šåˆ†æ Tab -->
            <div id="analytics-tab-content" class="tab-content hidden">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <div class="bg-white p-4 rounded-xl shadow border-l-4 border-blue-500">
                        <p class="text-sm text-gray-500 font-bold">ç¸½åº«å­˜é‡</p>
                        <h3 id="stat-total-items" class="text-3xl font-bold text-blue-700 mt-1">0</h3>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow border-l-4 border-amber-500">
                        <p class="text-sm text-gray-500 font-bold">å³å°‡éæœŸ</p>
                        <h3 id="stat-warning-items" class="text-3xl font-bold text-amber-600 mt-1">0</h3>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow border-l-4 border-green-500">
                        <p class="text-sm text-gray-500 font-bold">é ä¼°åƒ¹å€¼</p>
                        <h3 id="stat-total-value" class="text-3xl font-bold text-green-700 mt-1">$0</h3>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow border-l-4 border-teal-500">
                        <p class="text-sm text-gray-500 font-bold">ç´¯ç©æ¸›ç¢³é‡</p>
                        <h3 id="stat-carbon" class="text-3xl font-bold text-teal-700 mt-1">0 <span class="text-sm text-gray-400 font-normal">kg</span></h3>
                    </div>
                </div>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow border">
                        <h3 class="font-bold mb-4">æ–°é®®åº¦åˆ†ä½ˆ</h3>
                        <div class="relative h-64 w-full">
                            <canvas id="expirationChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow border">
                        <h3 class="font-bold mb-4">ç¨®é¡çµ±è¨ˆ</h3>
                        <div class="relative h-64 w-full">
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 7. ç¹ªæœ¬æ•…äº‹ Tab -->
            <div id="storybook-tab-content" class="tab-content hidden">
                <div class="bg-white p-8 rounded-xl shadow-sm border border-slate-100">
                    <h2 class="text-3xl font-bold text-slate-800 mb-6 text-center">ğŸ“– é£Ÿå…‰æ•…äº‹å±‹</h2>
                    <div class="grid md:grid-cols-3 gap-8">
                        <div class="story-card bg-orange-50 rounded-2xl p-6 shadow-md cursor-pointer flex flex-col items-center" onclick="openStory('carrot')">
                            <div class="text-6xl mb-4">ğŸ¥•</div>
                            <h3 class="text-xl font-bold text-orange-800 text-center mb-auto">å°ç´…è˜¿è””çš„æ¼‚æµ</h3>
                            <a href="https://gemini.google.com/share/cd719f59cb1f" class="w-full"><button class="w-full mt-4 py-2 bg-orange-400 text-white rounded-lg font-bold">é–±è®€æ•…äº‹</button></a>
                        </div>
                        <div class="story-card bg-sky-50 rounded-2xl p-6 shadow-md cursor-pointer flex flex-col items-center" onclick="openStory('robot')">
                            <div class="text-6xl mb-4">ğŸ¤–</div>
                            <h3 class="text-xl font-bold text-sky-800 text-center mb-auto">é˜¿å†·å®ˆè­·ç¥</h3>
                            <a href="https://gemini.google.com/share/a899039055f3" class="w-full"><button class="w-full mt-4 py-2 bg-sky-400 text-white rounded-lg font-bold">é–±è®€æ•…äº‹</button></a>
                        </div>
                        <div class="story-card bg-green-50 rounded-2xl p-6 shadow-md cursor-pointer flex flex-col items-center" onclick="openStory('earth')">
                            <div class="text-6xl mb-4">ğŸŒ</div>
                            <h3 class="text-xl font-bold text-green-800 text-center mb-auto">åœ°çƒåª½åª½çš„çœ¼æ·š</h3>
                            <a href="https://gemini.google.com/share/4add6be5c56e" class="w-full"><button class="w-full mt-4 py-2 bg-green-500 text-white rounded-lg font-bold">é–±è®€æ•…äº‹</button></a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 8. äº’å‹•æˆå°± Tab -->
            <div id="interactive-tab-content" class="tab-content hidden">
                <div class="bg-white rounded-xl p-6 shadow-lg border border-purple-100 mb-6">
                    <div class="flex items-center gap-2 mb-4">
                        <h3 class="text-xl font-bold text-purple-800">ğŸ† æˆ‘çš„æˆå°±å‹³ç« </h3>
                        <span class="text-xs bg-purple-100 text-purple-600 px-2 py-1 rounded-full font-bold">Gamification</span>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-4 gap-4" id="badges-container">
                        <!-- JS å‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-white rounded-xl p-6 shadow-lg border border-blue-100">
                        <h3 class="text-xl font-bold text-blue-800 mb-2">ğŸ³ ä»Šå¤©åƒä»€éº¼ï¼Ÿ</h3>
                        <div id="dishDisplay" class="w-full text-center bg-blue-50 py-12 rounded-xl my-4 text-xl text-gray-400 border border-blue-100">é»æ“ŠæŒ‰éˆ•é–‹å§‹...</div>
                        <button id="btnSpinDish" class="w-full py-3 bg-[#3b82f6] text-white rounded-full font-bold hover:bg-blue-600 shadow-lg transition transform active:scale-95">é–‹å§‹è½‰ç›¤</button>
                    </div>
                    <div class="bg-white rounded-xl p-6 shadow-lg border border-teal-100">
                        <h3 class="text-xl font-bold text-teal-800 mb-2">ğŸ§® æµªè²»è¨ˆç®—æ©Ÿ</h3>
                        <div class="space-y-4">
                            <div class="relative">
                                <input id="wasteItems" type="number" placeholder="æ¯é€±ä¸Ÿæ£„æ¨£æ•¸ (ex: 3)" class="w-full border p-2 rounded pr-10">
                                <span class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 font-bold">æ¨£</span>
                            </div>
                            <div class="relative">
                                <input id="wastePrice" type="number" placeholder="å¹³å‡å–®åƒ¹ (ex: 50)" class="w-full border p-2 rounded pr-10">
                                <span class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 font-bold">å…ƒ</span>
                            </div>
                            <button id="btnCalculateWaste" class="w-full py-3 bg-teal-600 text-white rounded-lg font-bold">è¨ˆç®—æå¤±</button>
                            <div id="wasteResult" class="hidden p-4 bg-red-50 text-red-800 rounded text-center font-bold"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ•…äº‹ Modal -->
    <div id="story-modal" class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/60 backdrop-blur-sm p-4">
        <div class="bg-white w-full max-w-2xl rounded-2xl shadow-2xl flex flex-col max-h-[80vh] animate-fade-up">
            <div id="story-header" class="p-6 bg-orange-100 flex justify-between items-center rounded-t-2xl">
                <h3 id="story-title" class="text-xl font-bold text-orange-900">æ•…äº‹é–±è®€ä¸­...</h3>
                <button onclick="closeStory()" class="text-2xl font-bold text-gray-500 hover:text-gray-800 transition">âœ•</button>
            </div>
            <div id="story-body" class="p-8 overflow-y-auto text-lg leading-loose whitespace-pre-line text-slate-700"></div>
        </div>
    </div>

    <!-- ç™»å…¥ Modal -->
    <div id="login-modal" class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/60 backdrop-blur-sm p-4">
        <div class="bg-white w-full max-w-md rounded-2xl shadow-2xl p-8 animate-fade-up">
            <h3 class="text-2xl font-bold text-slate-800 mb-6 text-center">æ­¡è¿å›ä¾†</h3>
            
            <form id="login-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-bold text-slate-700 mb-1">é›»å­éƒµä»¶</label>
                    <input type="email" class="w-full border border-slate-300 rounded-lg p-2.5 outline-none focus:ring-2 focus:ring-sky-500" placeholder="user@example.com">
                </div>
                <div>
                    <label class="block text-sm font-bold text-slate-700 mb-1">å¯†ç¢¼</label>
                    <input type="password" class="w-full border border-slate-300 rounded-lg p-2.5 outline-none focus:ring-2 focus:ring-sky-500" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                </div>
                <button type="submit" class="w-full bg-sky-500 text-white py-3 rounded-lg font-bold hover:bg-sky-600 transition shadow-lg mt-2">
                    ä¸€èˆ¬ç™»å…¥
                </button>
            </form>

            <div class="relative my-6">
                <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-200"></div></div>
                <div class="relative flex justify-center text-sm"><span class="px-2 bg-white text-gray-400 font-medium">å¿«é€Ÿç™»å…¥</span></div>
            </div>

            <button id="google-login-btn" class="w-full bg-white border border-gray-300 text-gray-700 py-2.5 rounded-lg font-bold hover:bg-gray-50 transition shadow-sm flex items-center justify-center gap-2 active:scale-95 transform">
                <svg class="w-5 h-5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                    <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                    <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                    <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                </svg>
                ä½¿ç”¨ Google å¸³è™Ÿç™»å…¥
            </button>

            <button onclick="closeLoginModal()" class="w-full text-slate-400 text-sm mt-4 hover:text-slate-600">å–æ¶ˆ</button>
        </div>
    </div>

    <!-- Script Module -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged, signInWithCustomToken, signInAnonymously } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';

        // å…¨åŸŸå‡½æ•¸ï¼šåˆ‡æ›é é¢
        window.switchTab = function(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            
            const target = document.getElementById(`${tabName}-tab-content`);
            if (target) target.classList.remove('hidden');
            
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            const activeNav = document.getElementById(`nav-${tabName}`);
            if(activeNav) activeNav.classList.add('active');
            
            // ç¨ç«‹é¦–é å°èˆªåˆ—æ§åˆ¶
            const nav = document.getElementById('main-nav');
            if (tabName === 'landing') nav.classList.add('hidden');
            else nav.classList.remove('hidden');
            
            // é é¢åˆå§‹åŒ–
            if(tabName === 'analytics') setTimeout(updateChartGlobal, 100);
            if(tabName === 'calendar') setTimeout(renderCalendar, 100);
            if(tabName === 'shopping') renderShoppingList();
            if(tabName === 'interactive') checkAchievements();
            
            window.scrollTo(0, 0); 
        }

        // Firebase
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {}; 
        let app, auth;
        try { app = initializeApp(firebaseConfig); auth = getAuth(app); } catch (e) { console.warn("Firebase Init Error:", e); }

        function updateUserUI(user) {
            const loginBtn = document.getElementById('login-btn');
            const userEmailDisplay = document.getElementById('user-email-display');
            const userDropdown = document.getElementById('user-dropdown');
            if (user) {
                const username = user.displayName || user.email.split('@')[0];
                const avatar = user.photoURL ? `<img src="${user.photoURL}" class="w-6 h-6 rounded-full border border-white">` : `<div class="w-6 h-6 bg-sky-500 rounded-full flex items-center justify-center text-xs text-white font-bold">${username[0].toUpperCase()}</div>`;
                loginBtn.innerHTML = `${avatar}<span class="font-bold text-slate-700 hidden sm:block truncate max-w-[80px]">${username}</span><svg class="w-4 h-4 text-slate-400 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>`;
                loginBtn.className = 'flex items-center gap-2 px-3 py-1.5 bg-white border border-sky-200 text-sky-700 rounded-lg hover:bg-sky-50 shadow-sm transition cursor-pointer';
                userEmailDisplay.innerText = user.email || "åŒ¿åä½¿ç”¨è€…";
                closeLoginModal();
            } else {
                loginBtn.innerHTML = `<span>ç™»å…¥</span>`;
                loginBtn.className = 'flex items-center gap-2 px-3 py-1.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 shadow-sm transition';
                userDropdown.classList.add('hidden'); userDropdown.classList.remove('flex');
            }
        }

        // ç¹ªæœ¬é‚è¼¯
        const stories = {
            'carrot': "ğŸ¥• **å°ç´…è˜¿è””çš„æ¼‚æµ**\n\næˆ‘æ˜¯å°ç´…è˜¿è””ï¼Œå› ç‚ºä¸»äººå¿˜è¨˜æˆ‘ï¼Œæˆ‘åœ¨å†°ç®±è§’è½å¾…äº†å¥½ä¹…...å¥½å†·å¥½é»‘å–”ï¼\n\nå…¶å¯¦åªè¦æŠŠæˆ‘æ”¾åœ¨é¡¯çœ¼çš„åœ°æ–¹ï¼Œæˆ–è€…æŠŠæ–°è²·çš„èœæ”¾å¾Œé¢ï¼ŒèˆŠçš„æ”¾å‰é¢ï¼ˆé€™å«åšã€Œå…ˆé€²å…ˆå‡ºã€ï¼‰ï¼Œæˆ‘å°±èƒ½æ—©é»è®Šæˆç¾å‘³çš„å’–å“©é£¯äº†ï¼\n\nè«‹ä¸è¦å¿˜è¨˜æˆ‘ï¼Œæˆ‘å¾ˆæœ‰ç‡Ÿé¤Šå–”ï¼",
            'robot': "ğŸ¤– **é˜¿å†·å®ˆè­·ç¥**\n\næˆ‘æ˜¯å†°ç®±å®ˆè­·ç¥é˜¿å†·ã€‚å‘¼ï½æœ€è¿‘ä¸»äººæŠŠå†°ç®±å¡å¤ªæ»¿äº†ï¼Œå†·æ°£å¹ä¸éå»ï¼Œæˆ‘éƒ½å¿«ç†±æšˆäº†ï¼\n\nå†°ç®±æœ€å¥½ä¿æŒã€Œä¸ƒåˆ†æ»¿ã€ï¼Œé€™æ¨£å†·ç©ºæ°£æ‰èƒ½æµé€šï¼Œé£Ÿç‰©æ‰ä¸æœƒå£æ‰ï¼Œè€Œä¸”é‚„èƒ½çœé›»å–”ï¼\n\nè®“æˆ‘å€‘ä¸€èµ·å¹«åœ°çƒé™æº«å§ï¼",
            'earth': "ğŸŒ **åœ°çƒåª½åª½çš„çœ¼æ·š**\n\nä½ çŸ¥é“å—ï¼Ÿæ¯æµªè²»ä¸€ä»½é£Ÿç‰©ï¼Œåœ°çƒåª½åª½å°±æœƒæ‰ä¸€æ»´çœ¼æ·šã€‚\n\nç”Ÿç”¢é£Ÿç‰©éœ€è¦å¥½å¤šæ°´ and åœŸåœ°ï¼Œå¦‚æœæˆ‘å€‘æŠŠé£Ÿç‰©ä¸Ÿæ‰ï¼Œé€™äº›è³‡æºå°±ç™½ç™½æµªè²»äº†ï¼Œé‚„æœƒç”¢ç”Ÿæº«å®¤æ°£é«”è®“åœ°çƒç™¼ç‡’ã€‚\n\nè®“æˆ‘å€‘ä¸€èµ·æŠŠé£¯åƒå…‰å…‰ï¼Œåšå€‹æƒœé£Ÿå°è‹±é›„ï¼Œæ‹¯æ•‘åœ°çƒå§ï¼"
        };
        window.openStory = function(id) {
            document.getElementById('story-body').innerHTML = stories[id].replace(/\n/g, '<br>');
            document.getElementById('story-modal').classList.remove('hidden');
            document.getElementById('story-modal').classList.add('flex');
        }
        window.closeStory = function() {
            document.getElementById('story-modal').classList.add('hidden');
            document.getElementById('story-modal').classList.remove('flex');
        }

        // è³‡æ–™åº«é‚è¼¯
        const foodDatabase = {};
        function generateFoodDatabase() {
            const rawData = [
                { type: 'è”¬èœ', life: 7, items: ['é«˜éº—èœ','å¤§ç™½èœ','å°ç™½èœ','é’æ±Ÿèœ','è èœ','ç©ºå¿ƒèœ','åœ°ç“œè‘‰','Aèœ','èŠ¥è˜­èœ','æ²¹èœ','è§èœ','çš‡å®®èœ','ç´…é³³èœ','å·ä¸ƒ','å±±è˜‡','éè²“','é¾é¬šèœ','èŠ¹èœ','é¦™èœ','ä¹å±¤å¡”','é’è”¥','è’œè‹—','éŸ­èœ','éŸ­é»ƒ','æ´‹è”¥','ç´…è”¥é ­','è’œé ­','è€è–‘','å«©è–‘','è¾£æ¤’','é’æ¤’','ç´…ç”œæ¤’','é»ƒç”œæ¤’','ç³¯ç±³æ¤’','æœå¤©æ¤’','å°é»ƒç“œ','å¤§é»ƒç“œ','çµ²ç“œ','è‹¦ç“œ','å†¬ç“œ','å—ç“œ','æ«›ç“œ','ä½›æ‰‹ç“œ','èŒ„å­','ç•ªèŒ„','ç‰›ç•ªèŒ„','å°ç•ªèŒ„','ç§‹è‘µ','ç‰ç±³','ç‰ç±³ç­','ç´…è˜¿è””','ç™½è˜¿è””','é¦¬ç³§è–¯','åœ°ç“œ','ç´«å¿ƒåœ°ç“œ','èŠ‹é ­','å±±è—¥','ç‰›è’¡','è“®è—•','ç«¹ç­','ç¶ ç«¹ç­','æ¡‚ç«¹ç­','ç­Šç™½ç­','è˜†ç­','è±†èŠ½èœ','é»ƒè±†èŠ½','å››å­£è±†','é•·è±‡è±†','è±Œè±†','ç”œè±†','æ¯›è±†','è ¶è±†','çš‡å¸è±†','ç¿¼è±†','é»‘æœ¨è€³','ç™½æœ¨è€³','é¦™è‡','é‡‘é‡è‡','æé®‘è‡','é´»å–œè‡','é›ªç™½è‡','ç§€çè‡','èˆè‡','è˜‘è‡','è‰è‡','çŒ´é ­è‡','èŒ¶æ¨¹è‡','å·´è¥¿è˜‘è‡','æ´‹è‡','ç¾ç™½è‡','çŠç‘šè‡','æµ·å¸¶','æµ·å¸¶çµ','æµ·å¸¶èŠ½','ç´«èœ','æ˜†å¸ƒ','é«®èœ'] },
                { type: 'æ°´æœ', life: 7, items: ['è˜‹æœ','é¦™è•‰','é³³æ¢¨','æœ¨ç“œ','è¥¿ç“œ','å“ˆå¯†ç“œ','è‘¡è„','è‰è“','è—è“','æ¡‘æ¤¹','æŸ³ä¸','æ©˜å­','è‘¡è„æŸš','æ–‡æ—¦','æª¸æª¬','é‡‘æ¡”','ç™¾é¦™æœ','èŠ’æœ','èŠ­æ¨‚','æ°´æ¢¨','é‡‹è¿¦','è“®éœ§','ç«é¾æœ','å¥‡ç•°æœ','æ¡ƒå­','æå­','æ«»æ¡ƒ','é…ªæ¢¨','æŸ¿å­','æ‡æ·','æ¥Šæ¡ƒ','è”æ','é¾çœ¼','ç”˜è”—','æ¤°å­','æ¦´æ§¤','å±±ç«¹','ç´…æ¯›ä¸¹','æ³¢ç¾…èœœ','ç„¡èŠ±æœ','çŸ³æ¦´','æ£—å­'] },
                { type: 'è‚‰é¡', life: 3, items: ['è±¬è‚‰','è±¬äº”èŠ±','è±¬é‡Œè‚Œ','è±¬çµè‚‰','æ¾é˜ªè±¬','è±¬è…³','è±¬æ’','è²¢ä¸¸','é¦™è…¸','åŸ¹æ ¹','ç«è…¿','ç†±ç‹—','è‡˜è‚‰','ç‰›è‚‰','ç‰›æ’','ç‰›äº”èŠ±','ç‰›å°æ’','ç‰›è…©','ç‰›ç­‹','ç‰›è‚š','ç‰›è…±','é›è‚‰','é›èƒ¸è‚‰','é›è…¿','é›ç¿…','é›èƒ—','é´¨è‚‰','é´¨èƒ¸','éµè‚‰','ç¾Šè‚‰'] },
                { type: 'æµ·é®®', life: 2, items: ['é®­é­š','é®ªé­š','é±ˆé­š','é¯–é­š','ç§‹åˆ€é­š','å³éƒ­é­š','é¯›é­š','é±¸é­š','è™±ç›®é­š','ç™½å¸¶é­š','åœŸé­ é­š','å¤šåˆ©é­š','æŸ³è‘‰é­š','é¦™é­š','çŸ³æ–‘é­š','ç™½è¦','è‰è¦','æ³°åœ‹è¦','é¾è¦','èƒèŸ¹','è›¤èœŠ','èœ†','èšµä»”','å¹²è²','é®‘é­š','é€æŠ½','å°å·','èŠ±æ','é­·é­š','ç« é­š','æµ·è†½','æµ·åƒ','é­šä¸¸'] },
                { type: 'ä¸»é£Ÿ', life: 180, items: ['ç™½ç±³','ç³™ç±³','ç´«ç±³','ç³¯ç±³','ç‡•éº¥','éºµç²‰','å¤ªç™½ç²‰','åœ°ç“œç²‰','éºµæ¢','ç¾©å¤§åˆ©éºµ','æ²¹éºµ','ç±³ç²‰','å†¬ç²‰','åå¸','è²æœ','å¯é Œ','æ³•åœ‹éºµåŒ…','é¥…é ­','åŒ…å­','æ°´é¤ƒ','æ¹¯åœ“','å¹´ç³•','è˜¿è””ç³•','è›‹é¤…çš®','è”¥æŠ“é¤…'] },
                { type: 'å¥¶è£½å“', life: 14, items: ['ç‰›å¥¶','è±†æ¼¿','ç±³æ¼¿','ç‡•éº¥å¥¶','å„ªæ ¼','å„ªé…ªä¹³','å¸ƒä¸','èµ·å¸','èµ·å¸ç‰‡','å¥¶æ²¹','é®®å¥¶æ²¹','ç…‰ä¹³','å¥¶ç²‰'] },
                { type: 'é£²æ–™', life: 180, items: ['ç¤¦æ³‰æ°´','æ°£æ³¡æ°´','ç¶ èŒ¶','ç´…èŒ¶','çƒé¾èŒ¶','å¥¶èŒ¶','å’–å•¡','å¯æ¨‚','é›ªç¢§','æ²™å£«','é‹å‹•é£²æ–™','æŸ³æ©™æ±','è˜‹æœæ±','å•¤é…’','ç´…é…’','å¨å£«å¿Œ','é«˜ç²±é…’'] },
                { type: 'èª¿å‘³æ–™', life: 365, items: ['é¹½','ç³–','é†¬æ²¹','é†¬æ²¹è†','è ”æ²¹','çƒé†‹','ç™½é†‹','ç±³é…’','å‘³é†‚','ç•ªèŒ„é†¬','ç”œè¾£é†¬','è¾£æ¤’é†¬','æ²™èŒ¶é†¬','ç¾ä¹ƒæ»‹','æ²™æ‹‰æ²¹','æ©„è¦½æ²¹','éº»æ²¹','é¦™æ²¹','å¥¶æ²¹','é»‘èƒ¡æ¤’','ç™½èƒ¡æ¤’','å’–å“©ç²‰','äº”é¦™ç²‰'] },
                { type: 'å…¶ä»–', life: 60, items: ['é›è›‹','çš®è›‹','é¹¹è›‹','è±†è…','è±†ä¹¾','è±†çš®','æ³¡èœ','è‚‰é¬†','æµ·è‹”','å … nuts','æ´‹èŠ‹ç‰‡','é¤…ä¹¾','å·§å…‹åŠ›','å†°æ·‡æ·‹','å†·å‡é£Ÿå“'] }
            ];
            let idCounter = 1;
            rawData.forEach(category => {
                category.items.forEach(itemName => {
                    foodDatabase[idCounter.toString()] = { n: itemName, t: category.type, d: category.life };
                    idCounter++;
                });
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            generateFoodDatabase(); 
            renderUI();
            checkAchievements();
            switchTab('landing'); // ç¢ºä¿ä¸€é–‹å§‹é¡¯ç¤º Landing Page

            // ç¶å®šäº‹ä»¶
            const manualBtn = document.getElementById('manual-scan-btn');
            const startBtn = document.getElementById('start-camera-btn');
            const stopBtn = document.getElementById('stop-camera-btn');
            const rescanBtn = document.getElementById('rescan-btn');
            const addIngredientForm = document.getElementById('add-ingredient-form');
            const matchRecipeBtn = document.getElementById('match-recipe-btn');
            const btnSpinDish = document.getElementById('btnSpinDish');
            const btnCalculateWaste = document.getElementById('btnCalculateWaste');
            const deleteExpiredBtn = document.getElementById('delete-expired-btn');
            const notifyBtn = document.getElementById('notify-btn');

            // Camera & DB Logic
            let stream = null;
            window.addToInventory = function(name, type, days) {
                const expiryDate = new Date(); expiryDate.setDate(expiryDate.getDate() + days); const dateStr = expiryDate.toISOString().split('T')[0];
                document.getElementById('name').value = name; 
                document.getElementById('type').value = type; 
                document.getElementById('expiryDate').value = dateStr;
                
                const newItem = { id: Date.now().toString() + "-" + Math.random().toString(36).substr(2, 5), name: name, type: type, expiry: dateStr };
                ingredients.push(newItem); 
                renderUI(); 
                checkAchievements();
            };

            if(manualBtn) manualBtn.addEventListener('click', () => { 
                const rawInput = document.getElementById('scan-input').value.trim(); 
                if (!rawInput) return Swal.fire('æç¤º', 'è«‹è¼¸å…¥ä»£ç¢¼ï¼', 'warning'); 
                
                // æ”¯æ´ä»¥ç©ºæ ¼ã€é€—è™Ÿæˆ–å…¨å½¢é€—è™Ÿåˆ†éš”
                const codes = rawInput.split(/[\s,ï¼Œ]+/).filter(c => c.length > 0);
                let identifiedItems = [];
                let missingCodes = [];

                codes.forEach(code => {
                    const item = foodDatabase[code];
                    if (item) {
                        identifiedItems.push(item);
                    } else {
                        missingCodes.push(code);
                    }
                });

                if (identifiedItems.length > 0) {
                    const itemNamesHtml = identifiedItems.map(it => `<b>${it.n}</b> (${it.t})`).join('<br>');
                    Swal.fire({
                        title: 'ç¢ºèªé£Ÿæå…¥åº«',
                        html: `æŸ¥è©¢åˆ°ä»¥ä¸‹é£Ÿæï¼š<br><div class="text-left mt-3 bg-slate-50 p-3 rounded border text-sm max-h-40 overflow-y-auto">${itemNamesHtml}</div><br>æ˜¯å¦ç¢ºèªåŠ å…¥åº«å­˜ï¼Ÿ`,
                        icon: 'question',
                        showCancelButton: true,
                        confirmButtonColor: '#0ea5e9',
                        cancelButtonColor: '#64748b',
                        confirmButtonText: 'ç¢ºå®šåŠ å…¥',
                        cancelButtonText: 'å–æ¶ˆ'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            identifiedItems.forEach(item => {
                                addToInventory(item.n, item.t, item.d);
                            });
                            document.getElementById('scan-input').value = ''; 
                            Swal.fire({ title: 'æˆåŠŸåŠ å…¥', icon: 'success', timer: 1500, showConfirmButton: false });
                        }
                    });
                } else {
                    Swal.fire('éŒ¯èª¤', `æ‰¾ä¸åˆ°ä»£ç¢¼ [${missingCodes.join(', ')}] å°æ‡‰çš„é£Ÿæ`, 'error');
                }
            });
            
            function triggerAutoScan() {
                document.getElementById('ai-scan-effect').classList.remove('hidden'); 
                rescanBtn.disabled = true;
                
                setTimeout(() => {
                    const keys = Object.keys(foodDatabase);
                    const scanNum = Math.floor(Math.random() * 2) + 2; 
                    let identifiedResults = [];
                    
                    for(let i = 0; i < scanNum; i++) {
                        const randomKey = keys[Math.floor(Math.random() * keys.length)];
                        const item = foodDatabase[randomKey];
                        identifiedResults.push(item);
                    }
                    
                    document.getElementById('ai-scan-effect').classList.add('hidden'); 
                    rescanBtn.disabled = false;
                    
                    const itemNamesHtml = identifiedResults.map(it => `<b>${it.n}</b> (${it.t})`).join('<br>');
                    
                    Swal.fire({ 
                        title: `AI å¤šé‡è­˜åˆ¥æˆåŠŸ (å…± ${scanNum} ä»¶)`, 
                        html: `è¾¨è­˜åˆ°ä»¥ä¸‹é£Ÿæï¼š<br><div class="text-left mt-3 bg-slate-50 p-3 rounded border text-sm max-h-40 overflow-y-auto">${itemNamesHtml}</div><br>æ˜¯å¦ç¢ºå®šåŠ å…¥åº«å­˜ï¼Ÿ`, 
                        icon: 'success', 
                        showCancelButton: true,
                        confirmButtonColor: '#0ea5e9',
                        cancelButtonColor: '#f59e0b',
                        confirmButtonText: 'ç¢ºå®šåŠ å…¥',
                        cancelButtonText: 'é‡æ–°æƒæ'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            identifiedResults.forEach(item => {
                                addToInventory(item.n, item.t, item.d);
                            });
                            Swal.fire({ title: 'å…¥åº«æˆåŠŸ', icon: 'success', timer: 1500, showConfirmButton: false });
                        } else if (result.dismiss === Swal.DismissReason.cancel) {
                            triggerAutoScan();
                        }
                    });
                }, 2000);
            }

            if(startBtn) startBtn.addEventListener('click', async () => { try { try { stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } }); } catch { stream = await navigator.mediaDevices.getUserMedia({ video: true }); } document.getElementById('camera-stream').srcObject = stream; document.getElementById('camera-stream').style.display = 'block'; document.getElementById('camera-overlay').classList.add('hidden'); startBtn.disabled = true; stopBtn.disabled = false; triggerAutoScan(); } catch (e) { Swal.fire('ç›¸æ©ŸéŒ¯èª¤', "ç„¡æ³•é–‹å•Ÿç›¸æ©Ÿ", 'error'); } });
            if(stopBtn) stopBtn.addEventListener('click', () => { if(stream) stream.getTracks().forEach(t => t.stop()); document.getElementById('camera-stream').style.display = 'none'; document.getElementById('camera-overlay').classList.remove('hidden'); document.getElementById('ai-scan-effect').classList.add('hidden'); startBtn.disabled = false; stopBtn.disabled = true; rescanBtn.disabled = true; });
            if(rescanBtn) rescanBtn.addEventListener('click', () => { document.getElementById('name').value = ''; document.getElementById('expiryDate').value = ''; triggerAutoScan(); });
            if(addIngredientForm) addIngredientForm.addEventListener('submit', (e) => { e.preventDefault(); const newItem = { id: Date.now().toString(), name: document.getElementById('name').value, type: document.getElementById('type').value, expiry: document.getElementById('expiryDate').value }; ingredients.push(newItem); renderUI(); checkAchievements(); document.getElementById('add-ingredient-form').reset(); Swal.fire('æˆåŠŸ', 'é£Ÿæå·²æ‰‹å‹•å…¥åº«ï¼', 'success'); });
            
            // é£Ÿè­œè³‡æ–™åº« (å…± 55 é“æ–™ç†)
            const recipeDB = [
                { name: 'å’–å“©é›è‚‰é£¯', ingredients: ['é›è‚‰', 'ç´…è˜¿è””', 'é¦¬éˆ´è–¯', 'æ´‹è”¥'], img: 'ğŸ›' },
                { name: 'è’œæ³¥ç™½è‚‰', ingredients: ['è±¬è‚‰', 'è’œé ­', 'é’è”¥'], img: 'ğŸ¥“' },
                { name: 'é®®è”¬ç‚’è‚‰ç‰‡', ingredients: ['è±¬è‚‰', 'é«˜éº—èœ', 'ç´…è˜¿è””', 'è’œé ­'], img: 'ğŸ¥—' },
                { name: 'ç´…ç‡’é±¸é­š', ingredients: ['é±¸é­š', 'è€è–‘', 'é’è”¥', 'è¾£æ¤’'], img: 'ğŸŸ' },
                { name: 'ç•ªèŒ„ç‚’è›‹', ingredients: ['ç•ªèŒ„', 'é›è›‹', 'é’è”¥'], img: 'ğŸ…' },
                { name: 'ç‰ç±³æ¿ƒæ¹¯', ingredients: ['ç‰ç±³', 'ç‰›å¥¶', 'é›è›‹', 'ç«è…¿'], img: 'ğŸ¥£' },
                { name: 'åœ°ç“œè‘‰ç‚’è’œæœ«', ingredients: ['åœ°ç“œè‘‰', 'è’œé ­'], img: 'ğŸ¥¬' },
                { name: 'ç¾©å¤§åˆ©è‚‰é†¬éºµ', ingredients: ['è±¬è‚‰', 'æ´‹è”¥', 'ç•ªèŒ„', 'ç¾©å¤§åˆ©éºµ'], img: 'ğŸ' },
                { name: 'éº»å©†è±†è…', ingredients: ['è±†è…', 'è±¬çµè‚‰', 'è’œé ­', 'å«©è–‘', 'è¾£æ¤’'], img: 'ğŸ®' },
                { name: 'å®®ä¿é›ä¸', ingredients: ['é›è‚‰', 'è¾£æ¤’', 'è’œé ­', 'èŠ±ç”Ÿ'], img: 'ğŸŒ¶ï¸' },
                { name: 'ä¸‰æ¯é›', ingredients: ['é›è‚‰', 'ä¹å±¤å¡”', 'è’œé ­', 'è€è–‘', 'é†¬æ²¹'], img: 'ğŸ—' },
                { name: 'ç´…ç‡’è‚‰', ingredients: ['è±¬è‚‰', 'é†¬æ²¹', 'ç³–', 'è’œé ­', 'è€è–‘'], img: 'ğŸ±' },
                { name: 'è–‘çµ²è›¤èœŠæ¹¯', ingredients: ['è›¤èœŠ', 'å«©è–‘', 'é’è”¥'], img: 'ğŸš' },
                { name: 'å°å¼è’¸è›‹', ingredients: ['é›è›‹', 'é†¬æ²¹'], img: 'ğŸ®' },
                { name: 'é’æ¤’ç‚’ç‰›è‚‰', ingredients: ['ç‰›è‚‰', 'é’æ¤’', 'è’œé ­'], img: 'ğŸ¥©' },
                { name: 'ç´…ç‡’ç‰›è‚‰éºµ', ingredients: ['ç‰›è‚‰', 'éºµæ¢', 'é’æ±Ÿèœ', 'é†¬æ²¹'], img: 'ğŸœ' },
                { name: 'è›‹ç‚’é£¯', ingredients: ['é›è›‹', 'ç™½ç±³', 'é’è”¥'], img: 'ğŸš' },
                { name: 'é³³æ¢¨è¦çƒ', ingredients: ['ç™½è¦', 'é³³æ¢¨', 'ç¾ä¹ƒæ»‹'], img: 'ğŸ' },
                { name: 'è”¥çˆ†é±¸é­š', ingredients: ['é±¸é­š', 'é’è”¥', 'è€è–‘'], img: 'ğŸŸ' },
                { name: 'é¹¹è›‹è‹¦ç“œ', ingredients: ['è‹¦ç“œ', 'é¹¹è›‹'], img: 'ğŸ¥’' },
                { name: 'ä»€éŒ¦ç‚’éºµ', ingredients: ['è±¬è‚‰', 'éºµæ¢', 'é«˜éº—èœ', 'ç´…è˜¿è””'], img: 'ğŸ' },
                { name: 'é…¸è¾£æ¹¯', ingredients: ['è±†è…', 'é»‘æœ¨è€³', 'ç´…è˜¿è””', 'é›è›‹', 'è±¬è‚‰'], img: 'ğŸ¥£' },
                { name: 'éº»æ²¹é›', ingredients: ['é›è‚‰', 'è€è–‘', 'éº»æ²¹', 'ç±³é…’'], img: 'ğŸ²' },
                { name: 'ä¹å±¤å¡”ç‚’è›¤èœŠ', ingredients: ['è›¤èœŠ', 'ä¹å±¤å¡”', 'è’œé ­', 'è€è–‘', 'è¾£æ¤’'], img: 'ğŸš' },
                { name: 'å‘³å™Œæ¹¯', ingredients: ['è±†è…', 'æµ·å¸¶èŠ½'], img: 'ğŸ¥£' },
                { name: 'é¦™ç…é®­é­š', ingredients: ['é®­é­š', 'æª¸æª¬', 'é¹½'], img: 'ğŸ£' },
                { name: 'è’œç‚’é«˜éº—èœ', ingredients: ['é«˜éº—èœ', 'è’œé ­'], img: 'ğŸ¥¬' },
                { name: 'æ»·è‚‰é£¯', ingredients: ['è±¬è‚‰', 'ç™½ç±³', 'é†¬æ²¹'], img: 'ğŸš' },
                { name: 'é¦™é…¥é›æ’', ingredients: ['é›è‚‰', 'éºµç²‰'], img: 'ğŸ—' },
                { name: 'è”¥æ²¹é¤…', ingredients: ['é’è”¥', 'éºµç²‰'], img: 'ğŸ¥' },
                { name: 'æ‰‹å·¥æ°´é¤ƒ', ingredients: ['è±¬è‚‰', 'é«˜éº—èœ', 'éºµç²‰'], img: 'ğŸ¥Ÿ' },
                { name: 'èšµä»”ç…', ingredients: ['èšµä»”', 'é›è›‹', 'å°ç™½èœ'], img: 'ğŸ³' },
                { name: 'èŠ¹èœç‚’é€æŠ½', ingredients: ['é€æŠ½', 'èŠ¹èœ', 'è’œé ­', 'å«©è–‘'], img: 'ğŸ¦‘' },
                { name: 'å¡”é¦™èŒ„å­', ingredients: ['èŒ„å­', 'è’œé ­', 'è¾£æ¤’', 'ä¹å±¤å¡”'], img: 'ğŸ†' },
                { name: 'æ³¡èœç‚’è‚‰ç‰‡', ingredients: ['è±¬è‚‰', 'æ³¡èœ'], img: 'ğŸ¥“' },
                { name: 'æ—¥å¼æ¶®æ¶®é‹', ingredients: ['ç‰›è‚‰', 'é«˜éº—èœ', 'ç‰ç±³', 'è±†è…'], img: 'ğŸ²' },
                { name: 'æ³°å¼ç‚’æ²³ç²‰', ingredients: ['ç™½è¦', 'éºµæ¢', 'è±†è…'], img: 'ğŸ¥¢' },
                { name: 'ç¶ å’–å“©é›', ingredients: ['é›è‚‰', 'å¥¶ç²‰', 'ç«¹ç­'], img: 'ğŸ¥˜' },
                { name: 'é®­é­šæ¡å£½å¸', ingredients: ['é®­é­š', 'ç™½ç±³'], img: 'ğŸ£' },
                { name: 'å‹ä¸¼(è±¬æ’é£¯)', ingredients: ['è±¬è‚‰', 'é›è›‹', 'æ´‹è”¥', 'ç™½ç±³'], img: 'ğŸ±' },
                { name: 'è¦ªå­ä¸¼', ingredients: ['é›è‚‰', 'é›è›‹', 'æ´‹è”¥', 'ç™½ç±³'], img: 'ğŸ±' },
                { name: 'è±šéª¨æ‹‰éºµ', ingredients: ['è±¬è‚‰', 'éºµæ¢', 'é›è›‹'], img: 'ğŸœ' },
                { name: 'ç‚¸è¦å¤©å©¦ç¾…', ingredients: ['ç™½è¦', 'éºµç²‰'], img: 'ğŸ¤' },
                { name: 'ç´…ç‡’ç‰›è‚‰ç‡‰èœ', ingredients: ['ç‰›è‚‰', 'ç´…è˜¿è””', 'é¦¬éˆ´è–¯', 'æ´‹è”¥'], img: 'ğŸ¥˜' },
                { name: 'è’œæœ«è¥¿è˜­èŠ±', ingredients: ['è¥¿è˜­èŠ±', 'è’œé ­'], img: 'ğŸ¥¦' },
                { name: 'å¥¶æ²¹å—ç“œæ¹¯', ingredients: ['å—ç“œ', 'ç‰›å¥¶', 'æ´‹è”¥'], img: 'ğŸ¥£' },
                { name: 'èˆ’è‚¥é›è‚‰æ²™æ‹‰', ingredients: ['é›è‚‰', 'ç•ªèŒ„', 'å°é»ƒç“œ'], img: 'ğŸ¥—' },
                { name: 'è’œé¦™é’æ±Ÿèœ', ingredients: ['é’æ±Ÿèœ', 'è’œé ­'], img: 'ğŸ¥¬' },
                { name: 'å¡”é¦™ç…è›‹', ingredients: ['é›è›‹', 'ä¹å±¤å¡”'], img: 'ğŸ³' },
                { name: 'æ»‘è›‹è¦ä»', ingredients: ['ç™½è¦', 'é›è›‹', 'é’è”¥'], img: 'ğŸ³' },
                { name: 'ç´…ç‡’å®¶å¸¸è±†è…', ingredients: ['è±†è…', 'ç´…è˜¿è””', 'é»‘æœ¨è€³'], img: 'ğŸ²' },
                { name: 'æ¸…ç‚’èŠ±æ¤°èœ', ingredients: ['èŠ±æ¤°èœ', 'è’œé ­'], img: 'ğŸ¥¦' },
                { name: 'åŸ¹æ ¹ç‚’é’æ¤’', ingredients: ['åŸ¹æ ¹', 'é’æ¤’'], img: 'ğŸ¥“' },
                { name: 'é¦™è…¸ç‚’é£¯', ingredients: ['é¦™è…¸', 'ç™½ç±³', 'é’è”¥'], img: 'ğŸš' },
                { name: 'å¥¶æ²¹åŸ¹æ ¹ç¾©å¤§åˆ©éºµ', ingredients: ['åŸ¹æ ¹', 'ç‰›å¥¶', 'ç¾©å¤§åˆ©éºµ'], img: 'æ¢' }
            ];

            if(matchRecipeBtn) matchRecipeBtn.addEventListener('click', () => {
                const resultsContainer = document.getElementById('recipe-results');
                resultsContainer.innerHTML = '<div class="col-span-full text-center py-12"><div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-[#f43f5e] mr-3"></div> åˆ†æä¸­...</div>';
                setTimeout(() => {
                    const myItems = ingredients.map(i => i.name);
                    const matchedRecipes = recipeDB.map(recipe => {
                        const hasCount = recipe.ingredients.filter(req => myItems.includes(req)).length;
                        const percent = Math.round((hasCount / recipe.ingredients.length) * 100);
                        return { ...recipe, hasCount, percent };
                    }).sort((a, b) => b.percent - a.percent);
                    resultsContainer.innerHTML = matchedRecipes.map(recipe => `
                        <div class="bg-white rounded-2xl shadow-md border border-slate-100 overflow-hidden hover:shadow-xl transition-all group">
                            <div class="h-40 bg-slate-50 flex items-center justify-center text-6xl group-hover:scale-110 transition-transform duration-500">${recipe.img}</div>
                            <div class="p-5">
                                <div class="flex justify-between items-start mb-3">
                                    <h3 class="font-bold text-lg text-slate-800">${recipe.name}</h3>
                                    <span class="text-sm font-bold text-green-600">${recipe.percent}% åŒ¹é…</span>
                                </div>
                                <div class="flex flex-wrap gap-2 mb-4">
                                    ${recipe.ingredients.map(ing => {
                                        const has = myItems.includes(ing);
                                        return `<span class="px-2 py-0.5 rounded-full text-[11px] font-bold ${has ? 'bg-green-100 text-green-700' : 'bg-red-50 text-red-600 opacity-60'}">${has ? 'æœ‰' : 'ç¼º'} ${ing}</span>`;
                                    }).join('')}
                                </div>
                                <button onclick="Swal.fire('${recipe.name}', 'æ­¤åŠŸèƒ½å°‡é€£æ¥è‡³é£Ÿè­œè©³ç´°æ­¥é©Ÿã€‚', 'info')" class="w-full py-2 bg-slate-800 text-white rounded-lg text-sm font-bold hover:bg-black transition">æŸ¥çœ‹å®Œæ•´é£Ÿè­œ</button>
                            </div>
                        </div>
                    `).join('');
                }, 800);
            });

            // è½‰ç›¤é‚è¼¯
            if(btnSpinDish) btnSpinDish.addEventListener('click', () => { 
                const d = document.getElementById('dishDisplay'); 
                const a = [
                    'å’–å“©é›è‚‰é£¯', 'ç¾©å¤§åˆ©è‚‰é†¬éºµ', 'éº»è¾£ç«é‹', 'ç´…ç‡’ç‰›è‚‰éºµ', 'å°å¼æ»·è‚‰é£¯', 
                    'å¤§ç”²èŠ‹é ­ç²¥', 'èšµä»”ç…', 'æ·±å‘è‡­è±†è…', 'å°å—æ“”ä»”éºµ', 'é¼æ³°è±å°ç± åŒ…', 
                    'æ—¥å¼æ¡å£½å¸', 'è±šéª¨æ‹‰éºµ', 'å‹ä¸¼(è±¬æ’é£¯)', 'ç¾å¼åŸ¹æ ¹æ¼¢å ¡', 'ç‘ªæ ¼éº—ç‰¹æŠ«è–©', 
                    'æ³•å¼æˆ°æ–§ç‰›æ’', 'å°å¼éµæ¿ç‡’', 'å››å·éº»è¾£ç‡™', 'å»£å¼ç‡’è‡˜é£¯', 'è¶Šå—ç«è»Šé ­æ²³ç²‰', 
                    'æ³°å¼æ‰“æ‹‹è±¬', 'éŸ“å¼ç‚¸é›é…å•¤é…’', 'çŸ³é‹æ‹Œé£¯', 'æ»‘è›‹è¦ä»é£¯', 'è‚‰ç‡¥ç‚’é£¯', 
                    'ä»€éŒ¦ç‚’éºµ', 'å˜‰ç¾©æ¶¼éºµ', 'å½°åŒ–è‚‰åœ“', 'å¤æ—©å‘³ç¢—ç²¿', 'è™å’¬è±¬(å‰²åŒ…)', 
                    'å¤§è…¸åŒ…å°è…¸', 'åŸºéš†ç”œä¸è¾£', 'å…«æ–¹é›²é›†é‹è²¼', 'é«˜éº—èœé®®è‚‰æ°´é¤ƒ', 'æº«å·å¤§é¤›é£©', 
                    'ç¦å·éº»é†¬éºµ', 'åŒ—äº¬ç‚¸é†¬éºµ', 'å°å—è™±ç›®é­šç²¥', 'å˜‰ç¾©ç«é›è‚‰é£¯', 'å½°åŒ–çˆŒè‚‰é£¯', 
                    'æºªæ¹–ç¾Šè‚‰çˆ', 'å…§é–€è¾¦æ¡Œèœ', 'åŒ—å¹³çƒ¤é´¨ä¸‰åƒ', 'çš®è›‹ç˜¦è‚‰ç²¥', 'å»£æ±çš®è›‹ç²¥', 
                    'èšµä»”éºµç·š', 'é¹¿æ¸¯æ½¤é¤…', 'ä¸‰æ˜Ÿè”¥æ²¹é¤…', 'çœ·æ‘éŸ­èœç›’', 'è„†çš®ç…é¤ƒ', 
                    'èµ·å¸è›‹é¤…', 'æ¸¯å¼è˜¿è””ç³•', 'é˜œæ­è±†æ¼¿æ²¹æ¢', 'å»£å¼é£²èŒ¶é»å¿ƒ', 'ç­å°¼è¿ªå…‹è›‹', 
                    'æ³•å¼åå¸', 'å¤å¨å¤·æ‹Œé£¯', 'å¢¨è¥¿å“¥æ²é¤…', 'ç…§ç‡’é›è…¿ä¸¼', 'ç´…é…’ç‡‰ç‰›è‚‰'
                ]; 
                let c = 0; 
                const totalSteps = 20 + Math.floor(Math.random() * 20);
                d.classList.add('text-blue-600'); 
                const i = setInterval(() => { 
                    const randomIndex = Math.floor(Math.random() * a.length);
                    d.innerText = a[randomIndex]; 
                    c++; 
                    if(c > totalSteps) { 
                        clearInterval(i); 
                        d.innerHTML = `âœ¨ ${d.innerText} âœ¨`; 
                    } 
                }, 80); 
            });

            if(btnCalculateWaste) btnCalculateWaste.addEventListener('click', () => { const i=document.getElementById('wasteItems').value; const p=document.getElementById('wastePrice').value; if(i&&p) document.getElementById('wasteResult').classList.remove('hidden'), document.getElementById('wasteResult').innerText=`ä¸€å¹´æµªè²»ç´„ NT$ ${(i*p*52).toLocaleString()}`; });
            if(deleteExpiredBtn) deleteExpiredBtn.addEventListener('click', () => { const init=ingredients.length; ingredients=ingredients.filter(i=> (new Date(i.expiry)-new Date())/(1000*3600*24)>=0); if(init-ingredients.length>0) { renderUI(); Swal.fire('å®Œæˆ','å·²æ¸…é™¤éæœŸé£Ÿæ','success'); } else Swal.fire('å¾ˆæ£’','æ²’æœ‰éæœŸé£Ÿæ','info'); });
        });

        let ingredients = [{id:1, name:'é›èƒ¸è‚‰', type:'è‚‰é¡', expiry: new Date(Date.now()+86400000*2).toISOString().split('T')[0]}, {id:2, name:'é«˜éº—èœ', type:'è”¬èœ', expiry: new Date(Date.now()+86400000*5).toISOString().split('T')[0]}, {id:3, name:'ç‰›å¥¶', type:'å¥¶è£½å“', expiry: new Date(Date.now()-86400000).toISOString().split('T')[0]}];
        let shoppingList = [{id:101, name:'é›è›‹', checked:false}, {id:102, name:'æ´‹è”¥', checked:true}];
        
        function renderUI() {
            const list = document.getElementById('ingredient-list');
            if(ingredients.length === 0) { list.innerHTML = '<p class="text-center text-gray-400 py-10">ç›®å‰æ²’æœ‰é£Ÿæ</p>'; } 
            else { list.innerHTML = ingredients.map(i => { const d=Math.ceil((new Date(i.expiry)-new Date())/86400000); let c='bg-sky-50 text-sky-800', s=`å‰© ${d} å¤©`; if(d<0){c='bg-gray-100 text-gray-500'; s='å·²éæœŸ';} else if(d<=2){c='bg-rose-50 text-rose-700'; s=`å‰© ${d} å¤© ğŸ”¥`;} return `<div class="flex justify-between items-center p-4 rounded-xl border mb-2 ${c}"><div><div class="font-bold text-lg">${i.name} <span class="text-xs border border-current px-1 rounded">${i.type}</span></div><div class="text-sm font-bold opacity-90">${s} (${i.expiry})</div></div><button onclick="removeIngredient('${i.id}')" class="text-xl px-2">âœ•</button></div>`; }).join(''); }
            const now = new Date();
            const warningCount = ingredients.filter(i=>(new Date(i.expiry)-now)/86400000<=3 && (new Date(i.expiry)-now)/86400000>=0).length;
            document.getElementById('stat-total-items').innerText = ingredients.length;
            document.getElementById('stat-warning-items').innerText = warningCount;
            document.getElementById('stat-total-value').innerText = '$' + (ingredients.length * 50);
            if(!document.getElementById('calendar-tab-content').classList.contains('hidden')) renderCalendar();
            if(!document.getElementById('analytics-tab-content').classList.contains('hidden')) updateChartGlobal();
        }
        window.removeIngredient = function(id) { Swal.fire({title:'ç¢ºå®šç§»é™¤?',icon:'warning',showCancelButton:true}).then(r=>{if(r.isConfirmed){ingredients=ingredients.filter(i=>i.id!=id);renderUI();checkAchievements();}}); };

        window.renderShoppingList = function() {
            document.getElementById('shopping-list-container').innerHTML = shoppingList.map(i => `<li class="flex items-center justify-between p-3 rounded-lg border ${i.checked?'bg-gray-50':''}"><div class="flex gap-3"><input type="checkbox" ${i.checked?'checked':''} onchange="toggleShoppingItem(${i.id})"><span class="${i.checked?'line-through text-gray-400':''}">${i.name}</span></div><button onclick="removeShoppingItem(${i.id})" class="text-gray-400">âœ•</button></li>`).join('');
        }
        window.addShoppingItem = function() { const v=document.getElementById('shopping-input').value; if(v){ shoppingList.push({id:Date.now(), name:v, checked:false}); document.getElementById('shopping-input').value=''; renderShoppingList(); } }
        window.removeShoppingItem = function(id) { shoppingList=shoppingList.filter(i=>i.id!=id); renderShoppingList(); }
        window.toggleShoppingItem = function(id) { const i=shoppingList.find(x=>x.id===id); if(i){i.checked=!i.checked; renderShoppingList();} }
        window.autoGenerateShoppingList = function() { shoppingList.push({id:Date.now(),name:'è’œé ­',checked:false}); renderShoppingList(); Swal.fire('å·²åŒ¯å…¥','å»ºè­°è³¼è²·ï¼šè’œé ­','success'); }

        let currentCalendarDate = new Date();
        window.changeMonth = function(o) { currentCalendarDate.setMonth(currentCalendarDate.getMonth()+o); renderCalendar(); }
        window.renderCalendar = function() {
            const y=currentCalendarDate.getFullYear(), m=currentCalendarDate.getMonth();
            document.getElementById('calendar-month-year').innerText = `${y}å¹´ ${m+1}æœˆ`;
            const daysInMonth = new Date(y, m+1, 0).getDate();
            const firstDay = new Date(y, m, 1).getDay();
            let html = '';
            for(let i=0;i<firstDay;i++) html+=`<div class="h-20 bg-slate-50 rounded-lg"></div>`;
            for(let d=1;d<=daysInMonth;d++) {
                const dateStr = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const count = ingredients.filter(i=>i.expiry===dateStr).length;
                html+=`<div onclick="selectDate('${dateStr}')" class="calendar-day bg-white border rounded-lg p-1 flex flex-col items-center cursor-pointer"><span class="text-sm">${d}</span>${count?`<span class="bg-red-500 text-white text-[10px] px-1.5 rounded-full">${count}</span>`:''}</div>`;
            }
            document.getElementById('calendar-grid').innerHTML = html;
        }
        window.selectDate = function(d) {
            const items = ingredients.filter(i=>i.expiry===d);
            document.getElementById('selected-date-display').innerText = d;
            document.getElementById('calendar-detail-list').innerHTML = items.length ? items.map(i=>`<div class="p-2 bg-red-50 text-red-800 rounded mb-1">${i.name}</div>`).join('') : '<p class="text-center text-gray-400 py-4">ç„¡éæœŸ</p>';
        }

        window.checkAchievements = function() { 
            const badges = [
                {id:'newbie', n:'åˆå…¥å»šæˆ¿', desc:'æ–°å¢ç¬¬ä¸€é …é£Ÿæ', icon:'ğŸ¥š', c: ingredients.length > 0},
                {id:'hoarder', n:'å€‰é¼ è½‰ä¸–', desc:'åº«å­˜è¶…é 10 é …', icon:'ğŸ¹', c: ingredients.length >= 10},
                {id:'veggie', n:'è”¬èœé”äºº', desc:'æ“æœ‰ 5 ç¨®ä»¥ä¸Šè”¬èœ', icon:'ğŸ¥¦', c: ingredients.filter(i=>i.type==='è”¬èœ').length >= 5},
                {id:'meat', n:'è‚‰è‚‰ä¸»ç¾©', desc:'æ“æœ‰ 5 ç¨®ä»¥ä¸Šè‚‰é¡', icon:'ğŸ–', c: ingredients.filter(i=>i.type==='è‚‰é¡').length >= 5},
                {id:'balanced', n:'å‡è¡¡é£²é£Ÿ', desc:'åŒæ™‚æ“æœ‰èœã€è‚‰ã€æ°´æœ', icon:'ğŸ¥—', c: ingredients.some(i=>i.type==='è”¬èœ') && ingredients.some(i=>i.type==='è‚‰é¡') && ingredients.some(i=>i.type==='æ°´æœ')},
                {id:'planner', n:'ç²¾æ‰“ç´°ç®—', desc:'æ²’æœ‰å³å°‡éæœŸçš„é£Ÿæ', icon:'ğŸ“…', c: ingredients.length > 0 && ingredients.every(i=>(new Date(i.expiry)-new Date())/86400000 > 3)},
                {id:'zero', n:'é›¶æµªè²»æˆ°å£«', desc:'ç›®å‰ç„¡éæœŸé£Ÿæ', icon:'ğŸŒ±', c: ingredients.length > 0 && ingredients.every(i=>(new Date(i.expiry)-new Date())/86400000 >= 0)},
                {id:'master', n:'é£Ÿå…‰å¤§å¸«', desc:'è§£é– 5 å€‹æˆå°±', icon:'ğŸ‘‘', c: false} 
            ];
            const unlockedCount = badges.filter(b => b.id !== 'master' && b.c).length;
            badges.find(b => b.id === 'master').c = unlockedCount >= 5;
            document.getElementById('badges-container').innerHTML = badges.map(b => `
                <div class="p-4 bg-slate-50 border rounded-xl flex flex-col items-center ${b.c ? 'badge-unlocked-anim' : 'badge-locked'} transition-all duration-500">
                    <div class="text-4xl mb-2">${b.icon}</div>
                    <div class="font-bold text-slate-700 text-sm">${b.n}</div>
                    <div class="text-[10px] text-slate-400 mt-1 text-center">${b.desc}</div>
                    ${b.c ? '<span class="mt-2 text-[10px] bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded-full">å·²è§£é–</span>' : ''}
                </div>
            `).join('');
        }

        let chart1, chart2;
        function updateChartGlobal() {
            if(chart1) chart1.destroy(); 
            if(chart2) chart2.destroy();
            const now = new Date();
            let fresh = 0, warning = 0, expired = 0, totalCarbon = 0;
            const carbonFactors = { 'è‚‰é¡': 15, 'æµ·é®®': 5, 'å¥¶è£½å“': 3, 'è”¬èœ': 0.5, 'æ°´æœ': 0.5, 'å…¶ä»–': 1 };
            const categoryCounts = { 'è”¬èœ': 0, 'è‚‰é¡': 0, 'æµ·é®®': 0, 'æ°´æœ': 0, 'å¥¶è£½å“': 0, 'å…¶ä»–': 0, 'ä¸»é£Ÿ': 0, 'é£²æ–™': 0, 'èª¿å‘³æ–™': 0 };
            ingredients.forEach(i => {
                const diffDays = Math.ceil((new Date(i.expiry) - now) / (1000 * 60 * 60 * 24));
                if (diffDays < 0) expired++; else if (diffDays <= 3) warning++; else fresh++;
                if (categoryCounts.hasOwnProperty(i.type)) { categoryCounts[i.type]++; totalCarbon += (carbonFactors[i.type] || 1) * 0.5; } else { categoryCounts['å…¶ä»–']++; totalCarbon += 0.5; }
            });
            document.getElementById('stat-carbon').innerHTML = `${Math.round(totalCarbon * 10) / 10} <span class="text-sm text-gray-400 font-normal">kg CO2e</span>`;
            chart1 = new Chart(document.getElementById('expirationChart'), {
                type: 'doughnut',
                data: { labels: ['æ–°é®®', 'å³æœŸ (3å¤©å…§)', 'éæœŸ'], datasets: [{ data: [fresh, warning, expired], backgroundColor: ['#34d399', '#fbbf24', '#f87171'] }] },
                options: { responsive: true, maintainAspectRatio: false }
            });
            const activeCategories = Object.keys(categoryCounts).filter(k => categoryCounts[k] > 0);
            const activeData = activeCategories.map(k => categoryCounts[k]);
            chart2 = new Chart(document.getElementById('categoryChart'), {
                type: 'bar',
                data: { labels: activeCategories, datasets: [{ label: 'æ•¸é‡', data: activeData, backgroundColor: '#38bdf8', borderRadius: 5 }] },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } } }
            });
        }
    </script>
</body>
</html>